import{d as X,r as n,o as Y,b,e as t,f as r,g as y,h as l,i as p,t as z,y as B,n as I}from"./index-B0vVrGoP.js";import{u as P}from"./user-Dae_coUz.js";import{_ as h}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ee=X({__name:"ProfileView",setup(ae){const V=n("profile"),i=n(!1),_=n(null),g=n(null),m=n(null),v=n(null),U=n(null),k=n(null),s=n({username:"",phone_number:"",address:"",avatar:null}),u=n({current_password:"",password:"",password_confirmation:""}),L=[o=>!!o||"New password is required",o=>o.length>=8||"Password must be at least 8 characters",o=>/[A-Z]/.test(o)||"Must contain at least one uppercase letter",o=>/[a-z]/.test(o)||"Must contain at least one lowercase letter",o=>/[0-9]/.test(o)||"Must contain at least one number"],q=async()=>{try{const o=await P.getProfile();_.value=o.data,s.value={username:o.data.username||"",phone_number:o.data.phone_number||"",address:o.data.address||"",avatar:null}}catch(o){console.error("Failed to fetch profile:",o)}},R=o=>{o?g.value=URL.createObjectURL(o):g.value=null},O=async()=>{var o,a;if(U.value.validate()){i.value=!0,m.value=null;try{const d=new FormData;Object.entries(s.value).forEach(([x,f])=>{f!==null&&f!==""&&d.append(x,f)}),await P.updateProfile(d),m.value={type:"success",text:"Profile updated successfully"},await q()}catch(d){m.value={type:"error",text:((a=(o=d.response)==null?void 0:o.data)==null?void 0:a.message)||"Failed to update profile"}}finally{i.value=!1}}},T=async()=>{var o,a;if(k.value.validate()){i.value=!0,v.value=null;try{await P.updatePassword(u.value),v.value={type:"success",text:"Password updated successfully"},u.value={current_password:"",password:"",password_confirmation:""}}catch(d){v.value={type:"error",text:((a=(o=d.response)==null?void 0:o.data)==null?void 0:a.message)||"Failed to update password"}}finally{i.value=!1}}};return Y(()=>{q()}),(o,a)=>{const d=r("v-img"),x=r("v-icon"),f=r("v-avatar"),E=r("v-card-title"),Z=r("v-card-subtitle"),$=r("v-card-item"),C=r("v-tab"),G=r("v-tabs"),H=r("v-file-input"),c=r("v-col"),w=r("v-text-field"),F=r("v-textarea"),M=r("v-row"),N=r("v-alert"),D=r("v-btn"),A=r("v-form"),S=r("v-window-item"),J=r("v-window"),K=r("v-card-text"),Q=r("v-card"),W=r("v-container");return y(),b(W,null,{default:t(()=>[l(M,{justify:"center"},{default:t(()=>[l(c,{cols:"12",md:"8"},{default:t(()=>[l(Q,null,{default:t(()=>[l($,null,{prepend:t(()=>[l(f,{size:"150",rounded:"0"},{default:t(()=>{var e,j;return[g.value||(e=_.value)!=null&&e.avatar_url?(y(),b(d,{key:0,src:g.value||((j=_.value)==null?void 0:j.avatar_url),alt:"avatar"},null,8,["src"])):(y(),b(x,{key:1,size:"100",color:"grey-lighten-1"},{default:t(()=>a[10]||(a[10]=[p(" mdi-account-circle ")])),_:1}))]}),_:1})]),default:t(()=>[l(E,{class:"text-h5 mb-1"},{default:t(()=>{var e;return[p(z(((e=_.value)==null?void 0:e.username)||"Loading..."),1)]}),_:1}),l(Z,null,{default:t(()=>{var e;return[p(z((e=_.value)==null?void 0:e.email),1)]}),_:1})]),_:1}),l(G,{modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=e=>V.value=e),grow:""},{default:t(()=>[l(C,{value:"profile"},{default:t(()=>a[11]||(a[11]=[p("Profile")])),_:1}),l(C,{value:"password"},{default:t(()=>a[12]||(a[12]=[p("Password")])),_:1})]),_:1},8,["modelValue"]),l(K,null,{default:t(()=>[l(J,{modelValue:V.value,"onUpdate:modelValue":a[9]||(a[9]=e=>V.value=e)},{default:t(()=>[l(S,{value:"profile"},{default:t(()=>[l(A,{onSubmit:B(O,["prevent"]),ref_key:"profileForm",ref:U},{default:t(()=>[l(M,null,{default:t(()=>[l(c,{cols:"12"},{default:t(()=>[l(H,{modelValue:s.value.avatar,"onUpdate:modelValue":a[1]||(a[1]=e=>s.value.avatar=e),accept:"image/*",label:"Avatar","prepend-icon":"mdi-camera",onChange:R},null,8,["modelValue"])]),_:1}),l(c,{cols:"12",md:"6"},{default:t(()=>[l(w,{modelValue:s.value.username,"onUpdate:modelValue":a[2]||(a[2]=e=>s.value.username=e),label:"Username",rules:[e=>!!e||"Username is required"],required:""},null,8,["modelValue","rules"])]),_:1}),l(c,{cols:"12",md:"6"},{default:t(()=>[l(w,{modelValue:s.value.phone,"onUpdate:modelValue":a[3]||(a[3]=e=>s.value.phone=e),label:"Phone Number",rules:[e=>!e||/^\d{10,11}$/.test(e)||"Invalid phone number"]},null,8,["modelValue","rules"])]),_:1}),l(c,{cols:"12"},{default:t(()=>[l(F,{modelValue:s.value.address,"onUpdate:modelValue":a[4]||(a[4]=e=>s.value.address=e),label:"Address",rows:"3"},null,8,["modelValue"])]),_:1}),l(c,{cols:"12"},{default:t(()=>[l(F,{modelValue:s.value.bio,"onUpdate:modelValue":a[5]||(a[5]=e=>s.value.bio=e),label:"Bio",rows:"3"},null,8,["modelValue"])]),_:1})]),_:1}),m.value?(y(),b(N,{key:0,type:m.value.type,text:m.value.text,class:"mb-4"},null,8,["type","text"])):I("",!0),l(D,{type:"submit",color:"primary",block:"",loading:i.value},{default:t(()=>a[13]||(a[13]=[p(" Update Profile ")])),_:1},8,["loading"])]),_:1},512)]),_:1}),l(S,{value:"password"},{default:t(()=>[l(A,{onSubmit:B(T,["prevent"]),ref_key:"passwordForm",ref:k},{default:t(()=>[l(w,{modelValue:u.value.current_password,"onUpdate:modelValue":a[6]||(a[6]=e=>u.value.current_password=e),label:"Current Password",type:"password",required:"",rules:[e=>!!e||"Current password is required"]},null,8,["modelValue","rules"]),l(w,{modelValue:u.value.password,"onUpdate:modelValue":a[7]||(a[7]=e=>u.value.password=e),label:"New Password",type:"password",required:"",rules:L},null,8,["modelValue"]),l(w,{modelValue:u.value.password_confirmation,"onUpdate:modelValue":a[8]||(a[8]=e=>u.value.password_confirmation=e),label:"Confirm New Password",type:"password",required:"",rules:[e=>!!e||"Password confirmation is required",e=>e===u.value.password||"Passwords do not match"]},null,8,["modelValue","rules"]),v.value?(y(),b(N,{key:0,type:v.value.type,text:v.value.text,class:"mb-4"},null,8,["type","text"])):I("",!0),l(D,{type:"submit",color:"primary",block:"",loading:i.value},{default:t(()=>a[14]||(a[14]=[p(" Update Password ")])),_:1},8,["loading"])]),_:1},512)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),re=h(ee,[["__scopeId","data-v-86862702"]]);export{re as default};
