import{d as e,r as a,o as l,b as u,e as t,f as r,g as s,h as o,i as d,t as n,y as v,n as i}from"./index-RCYdGSFb.js";import{u as p}from"./user-C_kzaS2J.js";import{_ as m}from"./_plugin-vue_export-helper-BCo6x5W8.js";const c=m(e({__name:"ProfileView",setup(e){const m=a("profile"),c=a(!1),f=a(null),w=a(null),_=a(null),y=a(null),b=a(null),V=a(null),h=a({username:"",phone_number:"",address:"",avatar:null}),g=a({current_password:"",password:"",password_confirmation:""}),x=[e=>!!e||"New password is required",e=>e.length>=8||"Password must be at least 8 characters",e=>/[A-Z]/.test(e)||"Must contain at least one uppercase letter",e=>/[a-z]/.test(e)||"Must contain at least one lowercase letter",e=>/[0-9]/.test(e)||"Must contain at least one number"],P=async()=>{try{const e=await p.getProfile();f.value=e.data,h.value={username:e.data.username||"",phone_number:e.data.phone_number||"",address:e.data.address||"",avatar:null}}catch(e){}},U=e=>{w.value=e?URL.createObjectURL(e):null},k=async()=>{var e,a;if(b.value.validate()){c.value=!0,_.value=null;try{const e=new FormData;Object.entries(h.value).forEach((([a,l])=>{null!==l&&""!==l&&e.append(a,l)})),await p.updateProfile(e),_.value={type:"success",text:"Profile updated successfully"},await P()}catch(l){_.value={type:"error",text:(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||"Failed to update profile"}}finally{c.value=!1}}},q=async()=>{var e,a;if(V.value.validate()){c.value=!0,y.value=null;try{await p.updatePassword(g.value),y.value={type:"success",text:"Password updated successfully"},g.value={current_password:"",password:"",password_confirmation:""}}catch(l){y.value={type:"error",text:(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||"Failed to update password"}}finally{c.value=!1}}};return l((()=>{P()})),(e,a)=>{const l=r("v-img"),p=r("v-icon"),P=r("v-avatar"),j=r("v-card-title"),F=r("v-card-subtitle"),C=r("v-card-item"),N=r("v-tab"),z=r("v-tabs"),A=r("v-file-input"),L=r("v-col"),M=r("v-text-field"),I=r("v-textarea"),O=r("v-row"),R=r("v-alert"),S=r("v-btn"),B=r("v-form"),D=r("v-window-item"),E=r("v-window"),Z=r("v-card-text"),$=r("v-card"),G=r("v-container");return s(),u(G,null,{default:t((()=>[o(O,{justify:"center"},{default:t((()=>[o(L,{cols:"12",md:"8"},{default:t((()=>[o($,null,{default:t((()=>[o(C,null,{prepend:t((()=>[o(P,{size:"150",rounded:"0"},{default:t((()=>{var e,r;return[w.value||(null==(e=f.value)?void 0:e.avatar_url)?(s(),u(l,{key:0,src:w.value||(null==(r=f.value)?void 0:r.avatar_url),alt:"avatar"},null,8,["src"])):(s(),u(p,{key:1,size:"100",color:"grey-lighten-1"},{default:t((()=>a[10]||(a[10]=[d(" mdi-account-circle ")]))),_:1}))]})),_:1})])),default:t((()=>[o(j,{class:"text-h5 mb-1"},{default:t((()=>{var e;return[d(n((null==(e=f.value)?void 0:e.username)||"Loading..."),1)]})),_:1}),o(F,null,{default:t((()=>{var e;return[d(n(null==(e=f.value)?void 0:e.email),1)]})),_:1})])),_:1}),o(z,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value=e),grow:""},{default:t((()=>[o(N,{value:"profile"},{default:t((()=>a[11]||(a[11]=[d("Profile")]))),_:1}),o(N,{value:"password"},{default:t((()=>a[12]||(a[12]=[d("Password")]))),_:1})])),_:1},8,["modelValue"]),o(Z,null,{default:t((()=>[o(E,{modelValue:m.value,"onUpdate:modelValue":a[9]||(a[9]=e=>m.value=e)},{default:t((()=>[o(D,{value:"profile"},{default:t((()=>[o(B,{onSubmit:v(k,["prevent"]),ref_key:"profileForm",ref:b},{default:t((()=>[o(O,null,{default:t((()=>[o(L,{cols:"12"},{default:t((()=>[o(A,{modelValue:h.value.avatar,"onUpdate:modelValue":a[1]||(a[1]=e=>h.value.avatar=e),accept:"image/*",label:"Avatar","prepend-icon":"mdi-camera",onChange:U},null,8,["modelValue"])])),_:1}),o(L,{cols:"12",md:"6"},{default:t((()=>[o(M,{modelValue:h.value.username,"onUpdate:modelValue":a[2]||(a[2]=e=>h.value.username=e),label:"Username",rules:[e=>!!e||"Username is required"],required:""},null,8,["modelValue","rules"])])),_:1}),o(L,{cols:"12",md:"6"},{default:t((()=>[o(M,{modelValue:h.value.phone,"onUpdate:modelValue":a[3]||(a[3]=e=>h.value.phone=e),label:"Phone Number",rules:[e=>!e||/^\d{10,11}$/.test(e)||"Invalid phone number"]},null,8,["modelValue","rules"])])),_:1}),o(L,{cols:"12"},{default:t((()=>[o(I,{modelValue:h.value.address,"onUpdate:modelValue":a[4]||(a[4]=e=>h.value.address=e),label:"Address",rows:"3"},null,8,["modelValue"])])),_:1}),o(L,{cols:"12"},{default:t((()=>[o(I,{modelValue:h.value.bio,"onUpdate:modelValue":a[5]||(a[5]=e=>h.value.bio=e),label:"Bio",rows:"3"},null,8,["modelValue"])])),_:1})])),_:1}),_.value?(s(),u(R,{key:0,type:_.value.type,text:_.value.text,class:"mb-4"},null,8,["type","text"])):i("",!0),o(S,{type:"submit",color:"primary",block:"",loading:c.value},{default:t((()=>a[13]||(a[13]=[d(" Update Profile ")]))),_:1},8,["loading"])])),_:1},512)])),_:1}),o(D,{value:"password"},{default:t((()=>[o(B,{onSubmit:v(q,["prevent"]),ref_key:"passwordForm",ref:V},{default:t((()=>[o(M,{modelValue:g.value.current_password,"onUpdate:modelValue":a[6]||(a[6]=e=>g.value.current_password=e),label:"Current Password",type:"password",required:"",rules:[e=>!!e||"Current password is required"]},null,8,["modelValue","rules"]),o(M,{modelValue:g.value.password,"onUpdate:modelValue":a[7]||(a[7]=e=>g.value.password=e),label:"New Password",type:"password",required:"",rules:x},null,8,["modelValue"]),o(M,{modelValue:g.value.password_confirmation,"onUpdate:modelValue":a[8]||(a[8]=e=>g.value.password_confirmation=e),label:"Confirm New Password",type:"password",required:"",rules:[e=>!!e||"Password confirmation is required",e=>e===g.value.password||"Passwords do not match"]},null,8,["modelValue","rules"]),y.value?(s(),u(R,{key:0,type:y.value.type,text:y.value.text,class:"mb-4"},null,8,["type","text"])):i("",!0),o(S,{type:"submit",color:"primary",block:"",loading:c.value},{default:t((()=>a[14]||(a[14]=[d(" Update Password ")]))),_:1},8,["loading"])])),_:1},512)])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-86862702"]]);export{c as default};
