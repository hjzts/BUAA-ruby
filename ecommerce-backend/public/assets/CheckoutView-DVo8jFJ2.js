import{d as e,r as a,c as l,o as t,b as u,e as s,B as d,u as i,f as r,g as n,h as o,j as c,m,i as p,y as v,k as f,l as _,F as h,t as b}from"./index-IlJQo5zm.js";import{c as y}from"./cart-fc6PdwP4.js";import{o as g}from"./order-_d18XnoC.js";import{_ as x}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./api-Cql6jV87.js";const V={class:"d-flex align-center mb-6"},q={class:"text-right"},w={class:"text-caption"},k={class:"text-subtitle-1"},j={class:"d-flex justify-space-between mb-4"},C={class:"d-flex justify-space-between mb-4"},$={class:"d-flex justify-space-between mb-4"},F={class:"d-flex justify-space-between mb-6"},I={class:"text-h6"},S={key:1,class:"d-flex justify-center align-center",style:{"min-height":"400px"}},P={class:"d-flex justify-space-between"},U={class:"text-h6"},O=x(e({__name:"CheckoutView",setup(e){const x=d(),O=i(),A=a(),N=a(!1),T=a(!1),z=a(!1),B=a([]),Q=a(!1),R=a({recipient_name:"",phone_number:"",postal_code:"",shipping_address:""}),D=l((()=>B.value.reduce(((e,a)=>e+a.quantity),0))),E=l((()=>B.value.reduce(((e,a)=>e+a.product.price*a.quantity),0))),G=l((()=>E.value>100?0:10)),H=l((()=>E.value+G.value)),J=async()=>{const{valid:e}=await A.value.validate();e&&(Q.value=!0)},K=async()=>{T.value=!0;try{const e=await g.createOrder({...R.value,items:B.value.map((e=>({product_id:e.product.id,quantity:e.quantity})))});await Promise.all(B.value.map((e=>y.removeFromCart(e.id)))),O.push({name:"order-detail",params:{id:e.data.id},query:{from:"checkout"}})}catch(e){}finally{T.value=!1,Q.value=!1}};return t((()=>{(async()=>{var e;N.value=!0;try{const a=null==(e=x.query.items)?void 0:e.toString().split(",").map(Number);if(!(null==a?void 0:a.length))return void O.push("/cart");const l=await y.getCartItems();B.value=l.data.filter((e=>a.includes(e.id))),B.value.length||O.push("/cart")}catch(a){}finally{N.value=!1}})()})),(e,a)=>{const l=r("v-btn"),t=r("v-col"),d=r("v-row"),i=r("v-card-title"),y=r("v-text-field"),g=r("v-textarea"),x=r("v-form"),L=r("v-card-text"),M=r("v-card"),W=r("v-img"),X=r("v-list-item-title"),Y=r("v-list-item-subtitle"),Z=r("v-list-item"),ee=r("v-list"),ae=r("v-divider"),le=r("v-progress-circular"),te=r("v-spacer"),ue=r("v-card-actions"),se=r("v-dialog"),de=r("v-container");return n(),u(de,null,{default:s((()=>[o(d,null,{default:s((()=>[o(t,{cols:"12"},{default:s((()=>[c("div",V,[o(l,{icon:"mdi-arrow-left",variant:"text",onClick:a[0]||(a[0]=e=>m(O).back())}),a[8]||(a[8]=c("h1",{class:"text-h4 ml-4"},"Checkout",-1))])])),_:1})])),_:1}),N.value?(n(),f("div",S,[o(le,{indeterminate:"",size:"64",color:"primary"})])):(n(),u(d,{key:0},{default:s((()=>[o(t,{cols:"12",md:"8"},{default:s((()=>[o(M,{class:"mb-4"},{default:s((()=>[o(i,{class:"bg-surface-variant"},{default:s((()=>a[9]||(a[9]=[p(" Shipping Information ")]))),_:1}),o(L,null,{default:s((()=>[o(x,{ref_key:"form",ref:A,modelValue:z.value,"onUpdate:modelValue":a[5]||(a[5]=e=>z.value=e),onSubmit:v(K,["prevent"])},{default:s((()=>[o(d,null,{default:s((()=>[o(t,{cols:"12"},{default:s((()=>[o(y,{modelValue:R.value.recipient_name,"onUpdate:modelValue":a[1]||(a[1]=e=>R.value.recipient_name=e),label:"Recipient Name",rules:[e=>!!e||"Name is required"],required:""},null,8,["modelValue","rules"])])),_:1}),o(t,{cols:"12",sm:"6"},{default:s((()=>[o(y,{modelValue:R.value.phone_number,"onUpdate:modelValue":a[2]||(a[2]=e=>R.value.phone_number=e),label:"Phone Number",rules:[e=>!!e||"Phone number is required",e=>/^\d{10,11}$/.test(e)||"Invalid phone number"],required:""},null,8,["modelValue","rules"])])),_:1}),o(t,{cols:"12",sm:"6"},{default:s((()=>[o(y,{modelValue:R.value.postal_code,"onUpdate:modelValue":a[3]||(a[3]=e=>R.value.postal_code=e),label:"Postal Code",rules:[e=>!!e||"Postal code is required",e=>/^\d{5,6}$/.test(e)||"Invalid postal code"],required:""},null,8,["modelValue","rules"])])),_:1}),o(t,{cols:"12"},{default:s((()=>[o(g,{modelValue:R.value.shipping_address,"onUpdate:modelValue":a[4]||(a[4]=e=>R.value.shipping_address=e),label:"Shipping Address",rules:[e=>!!e||"Address is required"],rows:"3",required:""},null,8,["modelValue","rules"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),o(M,null,{default:s((()=>[o(i,{class:"bg-surface-variant"},{default:s((()=>a[10]||(a[10]=[p(" Order Items ")]))),_:1}),o(ee,null,{default:s((()=>[(n(!0),f(h,null,_(B.value,(e=>(n(),u(Z,{key:e.id},{prepend:s((()=>[o(W,{src:e.product.image_url,width:"80",height:"80",cover:"",class:"rounded"},null,8,["src"])])),append:s((()=>[c("div",q,[c("div",w," $"+b(e.product.price)+" Ã— "+b(e.quantity),1),c("div",k," $"+b((e.product.price*e.quantity).toFixed(2)),1)])])),default:s((()=>[o(X,{class:"font-weight-medium"},{default:s((()=>[p(b(e.product.product_name),1)])),_:2},1024),o(Y,null,{default:s((()=>[p(" Quantity: "+b(e.quantity),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1}),o(t,{cols:"12",md:"4"},{default:s((()=>[o(M,{class:"sticky-card"},{default:s((()=>[o(i,{class:"bg-surface-variant"},{default:s((()=>a[11]||(a[11]=[p(" Order Summary ")]))),_:1}),o(L,{class:"pt-4"},{default:s((()=>[c("div",j,[a[12]||(a[12]=c("span",null,"Total Items:",-1)),c("span",null,b(D.value),1)]),c("div",C,[a[13]||(a[13]=c("span",null,"Subtotal:",-1)),c("span",null,"$"+b(E.value.toFixed(2)),1)]),c("div",$,[a[14]||(a[14]=c("span",null,"Shipping:",-1)),c("span",null,"$"+b(G.value.toFixed(2)),1)]),o(ae,{class:"mb-4"}),c("div",F,[a[15]||(a[15]=c("span",{class:"text-h6"},"Total:",-1)),c("span",I,"$"+b(H.value.toFixed(2)),1)]),o(l,{color:"primary",size:"large",block:"",loading:T.value,disabled:!z.value||!B.value.length,onClick:J},{default:s((()=>a[16]||(a[16]=[p(" Place Order ")]))),_:1},8,["loading","disabled"])])),_:1})])),_:1})])),_:1})])),_:1})),o(se,{modelValue:Q.value,"onUpdate:modelValue":a[7]||(a[7]=e=>Q.value=e),"max-width":"400"},{default:s((()=>[o(M,null,{default:s((()=>[o(i,null,{default:s((()=>a[17]||(a[17]=[p("Confirm Order")]))),_:1}),o(L,null,{default:s((()=>[a[19]||(a[19]=c("p",{class:"mb-4"},"Are you sure you want to place this order?",-1)),c("div",P,[a[18]||(a[18]=c("span",{class:"text-h6"},"Total Amount:",-1)),c("span",U,"$"+b(H.value.toFixed(2)),1)])])),_:1}),o(ue,null,{default:s((()=>[o(te),o(l,{variant:"text",onClick:a[6]||(a[6]=e=>Q.value=!1)},{default:s((()=>a[20]||(a[20]=[p(" Cancel ")]))),_:1}),o(l,{color:"primary",variant:"text",loading:T.value,onClick:K},{default:s((()=>a[21]||(a[21]=[p(" Confirm ")]))),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}}}),[["__scopeId","data-v-5bcf786a"]]);export{O as default};
