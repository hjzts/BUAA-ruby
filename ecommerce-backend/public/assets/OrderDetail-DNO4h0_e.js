import{d as at,r as g,o as ot,b as x,e,k as _,h as l,B as st,u as nt,f as s,g as u,m as rt,i as o,t as r,l as it,F as j,j as d,n as q}from"./index-B0vVrGoP.js";import{o as R}from"./order-CEDnoQ5w.js";import{f as ut}from"./format-BzRktsyD.js";import{_ as dt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./api-D7B8soog.js";const vt={class:"text-right"},ct={class:"text-body-2"},_t={class:"text-caption"},pt={class:"text-h6 mt-1"},ft={class:"text-right"},mt={class:"text-h6"},bt={class:"text-caption"},yt={key:0,class:"text-caption"},gt={key:1,class:"text-caption text-disabled"},xt={key:0,class:"text-caption"},kt={key:1,class:"text-caption text-disabled"},Ct={key:0,class:"text-caption"},wt={key:1,class:"text-caption text-disabled"},Ot={class:"text-caption"},Dt={class:"text-caption text-error"},Vt={key:1,class:"d-flex justify-center align-center",style:{"min-height":"400px"}},Pt=at({__name:"OrderDetail",setup(Nt){const M=st(),E=nt(),a=g(null),$=g(!1),p=g(!1),k=g(!1),C=g(!1),w=g(""),V=async()=>{$.value=!0;try{const i=parseInt(M.params.id),t=await R.getOrder(i);a.value=t.data,console.log("Order:",a.value),console.log("get order response: ",t)}catch(i){console.error("Failed to fetch order:",i)}finally{$.value=!1}},L=i=>({pending:"warning",paid:"info",shipped:"primary",delivered:"success",cancelled:"error"})[i],Q=i=>i.charAt(0).toUpperCase()+i.slice(1),b=i=>ut(new Date(i),"PPpp"),W=()=>{k.value=!0},G=async()=>{if(a.value){p.value=!0;try{await R.payOrder(a.value.id),k.value=!1,await V()}catch(i){console.error("Failed to pay order:",i)}finally{p.value=!1}}},H=()=>{C.value=!0},J=async()=>{if(!(!a.value||!w.value)){p.value=!0;try{await R.cancelOrder(a.value.id,w.value),C.value=!1,w.value="",await V()}catch(i){console.error("Failed to cancel order:",i)}finally{p.value=!1}}},K=async()=>{if(a.value){p.value=!0;try{await R.confirmDelivery(a.value.id),await V()}catch(i){console.error("Failed to confirm delivery:",i)}finally{p.value=!1}}};return ot(()=>{V()}),(i,t)=>{const v=s("v-btn"),X=s("v-chip"),f=s("v-card-title"),z=s("v-card-subtitle"),Y=s("v-card-item"),m=s("v-card"),S=s("v-col"),F=s("v-row"),Z=s("v-img"),y=s("v-list-item"),A=s("v-divider"),B=s("v-list"),c=s("v-icon"),P=s("v-list-item-title"),N=s("v-list-item-subtitle"),O=s("v-card-text"),D=s("v-timeline-item"),h=s("v-timeline"),I=s("v-spacer"),U=s("v-card-actions"),T=s("v-dialog"),tt=s("v-textarea"),et=s("v-container"),lt=s("v-progress-circular");return a.value?(u(),x(et,{key:0},{default:e(()=>[l(F,null,{default:e(()=>[l(S,{cols:"12"},{default:e(()=>[l(m,{class:"mb-4"},{default:e(()=>[l(Y,null,{prepend:e(()=>[l(v,{variant:"text",icon:"mdi-arrow-left",onClick:t[0]||(t[0]=n=>rt(E).back())})]),default:e(()=>[l(f,{class:"text-h5"},{default:e(()=>[o(" Order Details #"+r(a.value.attributes.id)+" ",1),l(X,{color:L(a.value.attributes.status),class:"ml-4"},{default:e(()=>[o(r(Q(a.value.attributes.status)),1)]),_:1},8,["color"])]),_:1}),l(z,null,{default:e(()=>[o(" Created at "+r(b(a.value.attributes.created_at)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(F,null,{default:e(()=>[l(S,{cols:"12",md:"6"},{default:e(()=>[l(m,{color:"secondary",class:"mb-4",hover:""},{default:e(()=>[l(f,{class:"bg-surface-variant"},{default:e(()=>t[6]||(t[6]=[o(" Order Items ")])),_:1}),l(B,null,{default:e(()=>[(u(!0),_(j,null,it(a.value.attributes.items,n=>(u(),x(y,{key:n.id,title:n.product_name,subtitle:n.description},{prepend:e(()=>[l(Z,{src:n.image_url||"/placeholder.png",width:"100",height:"100",cover:""},null,8,["src"])]),append:e(()=>[d("div",vt,[d("div",ct," Quantity: "+r(n.quantity),1),d("div",_t," Unit Price: $"+r(n.unit_price),1),d("div",pt," $"+r(n.total_price),1)])]),_:2},1032,["title","subtitle"]))),128)),l(A),l(y,null,{append:e(()=>[d("div",ft,[d("div",mt," Total Amount: $"+r(a.value.attributes.total_amount),1)])]),_:1})]),_:1})]),_:1}),l(m,null,{default:e(()=>[l(f,{class:"bg-surface-variant",hover:""},{default:e(()=>t[7]||(t[7]=[o(" Shipping Information ")])),_:1}),l(O,null,{default:e(()=>[l(B,{density:"compact"},{default:e(()=>[l(y,null,{prepend:e(()=>[l(c,null,{default:e(()=>t[8]||(t[8]=[o("mdi-account")])),_:1})]),default:e(()=>[l(P,null,{default:e(()=>t[9]||(t[9]=[o("Recipient")])),_:1}),l(N,null,{default:e(()=>[o(r(a.value.attributes.recipient_name),1)]),_:1})]),_:1}),l(y,null,{prepend:e(()=>[l(c,null,{default:e(()=>t[10]||(t[10]=[o("mdi-phone")])),_:1})]),default:e(()=>[l(P,null,{default:e(()=>t[11]||(t[11]=[o("Phone")])),_:1}),l(N,null,{default:e(()=>[o(r(a.value.attributes.phone_number),1)]),_:1})]),_:1}),l(y,null,{prepend:e(()=>[l(c,null,{default:e(()=>t[12]||(t[12]=[o("mdi-map-marker")])),_:1})]),default:e(()=>[l(P,null,{default:e(()=>t[13]||(t[13]=[o("Address")])),_:1}),l(N,null,{default:e(()=>[o(r(a.value.attributes.shipping_address),1)]),_:1})]),_:1}),l(y,null,{prepend:e(()=>[l(c,null,{default:e(()=>t[14]||(t[14]=[o("mdi-postage-stamp")])),_:1})]),default:e(()=>[l(P,null,{default:e(()=>t[15]||(t[15]=[o("Postal Code")])),_:1}),l(N,null,{default:e(()=>[o(r(a.value.attributes.postal_code),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(S,{cols:"12",md:"6"},{default:e(()=>[l(m,{class:"mb-4"},{default:e(()=>[l(f,{class:"bg-surface-variant",hover:""},{default:e(()=>t[16]||(t[16]=[o(" Order Status ")])),_:1}),l(O,null,{default:e(()=>[l(h,null,{default:e(()=>[l(D,{"dot-color":"primary",size:"small"},{default:e(()=>[t[17]||(t[17]=d("div",{class:"text-subtitle-2"},"Order Created",-1)),d("div",bt,r(b(a.value.attributes.created_at)),1)]),_:1}),l(D,{"dot-color":a.value.attributes.paid_at?"success":"grey",size:"small"},{default:e(()=>[t[18]||(t[18]=d("div",{class:"text-subtitle-2"},"Payment",-1)),a.value.attributes.paid_at?(u(),_("div",yt,r(b(a.value.attributes.paid_at)),1)):(u(),_("div",gt," Waiting for payment "))]),_:1},8,["dot-color"]),l(D,{"dot-color":a.value.attributes.shipped_at?"info":"grey",size:"small"},{default:e(()=>[t[19]||(t[19]=d("div",{class:"text-subtitle-2"},"Shipping",-1)),a.value.attributes.shipped_at?(u(),_("div",xt,r(b(a.value.attributes.shipped_at)),1)):(u(),_("div",kt," Not shipped yet "))]),_:1},8,["dot-color"]),l(D,{"dot-color":a.value.attributes.delivered_at?"success":"grey",size:"small"},{default:e(()=>[t[20]||(t[20]=d("div",{class:"text-subtitle-2"},"Delivery",-1)),a.value.attributes.delivered_at?(u(),_("div",Ct,r(b(a.value.attributes.delivered_at)),1)):(u(),_("div",wt," Not delivered yet "))]),_:1},8,["dot-color"]),a.value.attributes.cancelled_at?(u(),x(D,{key:0,"dot-color":"error",size:"small"},{default:e(()=>[t[21]||(t[21]=d("div",{class:"text-subtitle-2"},"Cancelled",-1)),d("div",Ot,r(b(a.value.attributes.cancelled_at)),1),d("div",Dt," Reason: "+r(a.value.attributes.cancellation_reason),1)]),_:1})):q("",!0)]),_:1})]),_:1})]),_:1}),l(m,{elevation:"3",rounded:"lg",class:"mb-4"},{default:e(()=>[l(f,{class:"bg-surface-variant text-white rounded-t-lg"},{default:e(()=>[l(c,{class:"mr-2"},{default:e(()=>t[22]||(t[22]=[o("mdi-cog")])),_:1}),t[23]||(t[23]=o(" Actions "))]),_:1}),l(O,{class:"d-flex flex-column align-center py-4"},{default:e(()=>[a.value.attributes.status==="pending"?(u(),_(j,{key:0},[l(v,{color:"primary",block:"",class:"mb-3",elevation:"2",large:"",onClick:W},{default:e(()=>[l(c,{left:""},{default:e(()=>t[24]||(t[24]=[o("mdi-cash")])),_:1}),t[25]||(t[25]=o(" Pay Now "))]),_:1}),l(v,{color:"error",block:"",elevation:"1",outlined:"",large:"",onClick:H},{default:e(()=>[l(c,{left:""},{default:e(()=>t[26]||(t[26]=[o("mdi-cancel")])),_:1}),t[27]||(t[27]=o(" Cancel Order "))]),_:1})],64)):a.value.attributes.status==="shipped"?(u(),x(v,{key:1,color:"success",block:"",elevation:"2",large:"",onClick:K},{default:e(()=>[l(c,{left:""},{default:e(()=>t[28]||(t[28]=[o("mdi-truck-check")])),_:1}),t[29]||(t[29]=o(" Confirm Delivery "))]),_:1})):a.value.attributes.status==="paid"?(u(),x(v,{key:2,color:"success",block:"",outlined:"",large:"",disabled:""},{default:e(()=>[l(c,{left:""},{default:e(()=>t[30]||(t[30]=[o("mdi-check-circle")])),_:1}),t[31]||(t[31]=o(" 已支付 "))]),_:1})):a.value.attributes.status==="delivered"?(u(),x(v,{key:3,color:"success",block:"",outlined:"",large:"",disabled:""},{default:e(()=>[l(c,{left:""},{default:e(()=>t[32]||(t[32]=[o("mdi-package-variant-closed")])),_:1}),t[33]||(t[33]=o(" 已接收 "))]),_:1})):q("",!0)]),_:1}),l(A),l(z,{class:"text-center text-caption py-2"},{default:e(()=>t[34]||(t[34]=[o(" Manage your order actions here ")])),_:1})]),_:1})]),_:1})]),_:1}),l(T,{modelValue:k.value,"onUpdate:modelValue":t[2]||(t[2]=n=>k.value=n),"max-width":"400"},{default:e(()=>[l(m,null,{default:e(()=>[l(f,null,{default:e(()=>t[35]||(t[35]=[o("Confirm Payment")])),_:1}),l(O,null,{default:e(()=>[d("p",null,"Total Amount: $"+r(a.value.total_amount),1)]),_:1}),l(U,null,{default:e(()=>[l(I),l(v,{variant:"text",onClick:t[1]||(t[1]=n=>k.value=!1)},{default:e(()=>t[36]||(t[36]=[o(" Cancel ")])),_:1}),l(v,{color:"primary",variant:"text",loading:p.value,onClick:G},{default:e(()=>t[37]||(t[37]=[o(" Confirm ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(T,{modelValue:C.value,"onUpdate:modelValue":t[5]||(t[5]=n=>C.value=n),"max-width":"400"},{default:e(()=>[l(m,null,{default:e(()=>[l(f,null,{default:e(()=>t[38]||(t[38]=[o("Cancel Order")])),_:1}),l(O,null,{default:e(()=>[l(tt,{modelValue:w.value,"onUpdate:modelValue":t[3]||(t[3]=n=>w.value=n),label:"Cancellation Reason",rules:[n=>!!n||"Reason is required"],rows:"3"},null,8,["modelValue","rules"])]),_:1}),l(U,null,{default:e(()=>[l(I),l(v,{variant:"text",onClick:t[4]||(t[4]=n=>C.value=!1)},{default:e(()=>t[39]||(t[39]=[o(" Cancel ")])),_:1}),l(v,{color:"error",variant:"text",loading:p.value,onClick:J},{default:e(()=>t[40]||(t[40]=[o(" Confirm ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):(u(),_("div",Vt,[l(lt,{indeterminate:"",size:"64",color:"primary"})]))}}}),At=dt(Pt,[["__scopeId","data-v-63716645"]]);export{At as default};
