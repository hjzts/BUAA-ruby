import{d as X,r as m,c as x,o as Y,b as F,e as o,B as Z,u as ee,f as s,g as _,h as t,j as a,m as te,i as c,y as le,k as N,l as oe,F as ae,t as r}from"./index-B0vVrGoP.js";import{c as O}from"./cart-DAnYCAh8.js";import{o as se}from"./order-CEDnoQ5w.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./api-D7B8soog.js";const re={class:"d-flex align-center mb-6"},ue={class:"text-right"},ie={class:"text-caption"},de={class:"text-subtitle-1"},ce={class:"d-flex justify-space-between mb-4"},me={class:"d-flex justify-space-between mb-4"},pe={class:"d-flex justify-space-between mb-4"},ve={class:"d-flex justify-space-between mb-6"},_e={class:"text-h6"},fe={key:1,class:"d-flex justify-center align-center",style:{"min-height":"400px"}},be={class:"d-flex justify-space-between"},ge={class:"text-h6"},ye=X({__name:"CheckoutView",setup(xe){const P=Z(),f=ee(),S=m(),V=m(!1),b=m(!1),w=m(!1),u=m([]),v=m(!1),i=m({recipient_name:"",phone_number:"",postal_code:"",shipping_address:""}),U=x(()=>u.value.reduce((n,e)=>n+e.quantity,0)),k=x(()=>u.value.reduce((n,e)=>n+e.product.price*e.quantity,0)),$=x(()=>k.value>100?0:10),I=x(()=>k.value+$.value),B=async()=>{var n;V.value=!0;try{const e=(n=P.query.items)==null?void 0:n.toString().split(",").map(Number);if(!(e!=null&&e.length)){f.push("/cart");return}const p=await O.getCartItems();u.value=p.data.filter(d=>e.includes(d.id)),console.log("cartItems: ",u.value),u.value.length||f.push("/cart")}catch(e){console.error("Failed to fetch cart items:",e)}finally{V.value=!1}},A=async()=>{const{valid:n}=await S.value.validate();n&&(v.value=!0)},j=async()=>{b.value=!0;try{const n=await se.createOrder({...i.value,items:u.value.map(e=>({product_id:e.product.id,quantity:e.quantity}))});await Promise.all(u.value.map(e=>O.removeFromCart(e.id))),f.push({name:"order-detail",params:{id:n.data.id},query:{from:"checkout"}})}catch(n){console.error("Failed to create order:",n)}finally{b.value=!1,v.value=!1}};return Y(()=>{B()}),(n,e)=>{const p=s("v-btn"),d=s("v-col"),C=s("v-row"),g=s("v-card-title"),q=s("v-text-field"),D=s("v-textarea"),T=s("v-form"),h=s("v-card-text"),y=s("v-card"),R=s("v-img"),z=s("v-list-item-title"),M=s("v-list-item-subtitle"),Q=s("v-list-item"),E=s("v-list"),L=s("v-divider"),G=s("v-progress-circular"),H=s("v-spacer"),J=s("v-card-actions"),K=s("v-dialog"),W=s("v-container");return _(),F(W,null,{default:o(()=>[t(C,null,{default:o(()=>[t(d,{cols:"12"},{default:o(()=>[a("div",re,[t(p,{icon:"mdi-arrow-left",variant:"text",onClick:e[0]||(e[0]=l=>te(f).back())}),e[8]||(e[8]=a("h1",{class:"text-h4 ml-4"},"Checkout",-1))])]),_:1})]),_:1}),V.value?(_(),N("div",fe,[t(G,{indeterminate:"",size:"64",color:"primary"})])):(_(),F(C,{key:0},{default:o(()=>[t(d,{cols:"12",md:"8"},{default:o(()=>[t(y,{class:"mb-4"},{default:o(()=>[t(g,{class:"bg-surface-variant"},{default:o(()=>e[9]||(e[9]=[c(" Shipping Information ")])),_:1}),t(h,null,{default:o(()=>[t(T,{ref_key:"form",ref:S,modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=l=>w.value=l),onSubmit:le(j,["prevent"])},{default:o(()=>[t(C,null,{default:o(()=>[t(d,{cols:"12"},{default:o(()=>[t(q,{modelValue:i.value.recipient_name,"onUpdate:modelValue":e[1]||(e[1]=l=>i.value.recipient_name=l),label:"Recipient Name",rules:[l=>!!l||"Name is required"],required:""},null,8,["modelValue","rules"])]),_:1}),t(d,{cols:"12",sm:"6"},{default:o(()=>[t(q,{modelValue:i.value.phone_number,"onUpdate:modelValue":e[2]||(e[2]=l=>i.value.phone_number=l),label:"Phone Number",rules:[l=>!!l||"Phone number is required",l=>/^\d{10,11}$/.test(l)||"Invalid phone number"],required:""},null,8,["modelValue","rules"])]),_:1}),t(d,{cols:"12",sm:"6"},{default:o(()=>[t(q,{modelValue:i.value.postal_code,"onUpdate:modelValue":e[3]||(e[3]=l=>i.value.postal_code=l),label:"Postal Code",rules:[l=>!!l||"Postal code is required",l=>/^\d{5,6}$/.test(l)||"Invalid postal code"],required:""},null,8,["modelValue","rules"])]),_:1}),t(d,{cols:"12"},{default:o(()=>[t(D,{modelValue:i.value.shipping_address,"onUpdate:modelValue":e[4]||(e[4]=l=>i.value.shipping_address=l),label:"Shipping Address",rules:[l=>!!l||"Address is required"],rows:"3",required:""},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(y,null,{default:o(()=>[t(g,{class:"bg-surface-variant"},{default:o(()=>e[10]||(e[10]=[c(" Order Items ")])),_:1}),t(E,null,{default:o(()=>[(_(!0),N(ae,null,oe(u.value,l=>(_(),F(Q,{key:l.id},{prepend:o(()=>[t(R,{src:l.product.image_url,width:"80",height:"80",cover:"",class:"rounded"},null,8,["src"])]),append:o(()=>[a("div",ue,[a("div",ie," $"+r(l.product.price)+" Ã— "+r(l.quantity),1),a("div",de," $"+r((l.product.price*l.quantity).toFixed(2)),1)])]),default:o(()=>[t(z,{class:"font-weight-medium"},{default:o(()=>[c(r(l.product.product_name),1)]),_:2},1024),t(M,null,{default:o(()=>[c(" Quantity: "+r(l.quantity),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),t(d,{cols:"12",md:"4"},{default:o(()=>[t(y,{class:"sticky-card"},{default:o(()=>[t(g,{class:"bg-surface-variant"},{default:o(()=>e[11]||(e[11]=[c(" Order Summary ")])),_:1}),t(h,{class:"pt-4"},{default:o(()=>[a("div",ce,[e[12]||(e[12]=a("span",null,"Total Items:",-1)),a("span",null,r(U.value),1)]),a("div",me,[e[13]||(e[13]=a("span",null,"Subtotal:",-1)),a("span",null,"$"+r(k.value.toFixed(2)),1)]),a("div",pe,[e[14]||(e[14]=a("span",null,"Shipping:",-1)),a("span",null,"$"+r($.value.toFixed(2)),1)]),t(L,{class:"mb-4"}),a("div",ve,[e[15]||(e[15]=a("span",{class:"text-h6"},"Total:",-1)),a("span",_e,"$"+r(I.value.toFixed(2)),1)]),t(p,{color:"primary",size:"large",block:"",loading:b.value,disabled:!w.value||!u.value.length,onClick:A},{default:o(()=>e[16]||(e[16]=[c(" Place Order ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})),t(K,{modelValue:v.value,"onUpdate:modelValue":e[7]||(e[7]=l=>v.value=l),"max-width":"400"},{default:o(()=>[t(y,null,{default:o(()=>[t(g,null,{default:o(()=>e[17]||(e[17]=[c("Confirm Order")])),_:1}),t(h,null,{default:o(()=>[e[19]||(e[19]=a("p",{class:"mb-4"},"Are you sure you want to place this order?",-1)),a("div",be,[e[18]||(e[18]=a("span",{class:"text-h6"},"Total Amount:",-1)),a("span",ge,"$"+r(I.value.toFixed(2)),1)])]),_:1}),t(J,null,{default:o(()=>[t(H),t(p,{variant:"text",onClick:e[6]||(e[6]=l=>v.value=!1)},{default:o(()=>e[20]||(e[20]=[c(" Cancel ")])),_:1}),t(p,{color:"primary",variant:"text",loading:b.value,onClick:j},{default:o(()=>e[21]||(e[21]=[c(" Confirm ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),he=ne(ye,[["__scopeId","data-v-5bcf786a"]]);export{he as default};
