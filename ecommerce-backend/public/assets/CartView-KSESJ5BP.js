import{d as e,r as a,c as l,w as t,o as u,k as i,h as s,e as r,F as d,u as o,f as n,g as c,j as m,i as p,t as v,b as f,l as _,m as b,n as h}from"./index-RCYdGSFb.js";import{c as y}from"./cart-Ct7A41YY.js";import{o as g}from"./order-TV5cZrDr.js";import{_ as x}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./api-CfODcUyk.js";const k={class:"d-flex align-center mb-6"},C={class:"d-flex flex-column"},V={class:"text-primary"},w={key:0,class:"text-error"},q={class:"d-flex flex-column align-end"},j={class:"quantity-control mb-2"},S={class:"mx-3"},z={class:"text-h6"},I={class:"d-flex justify-space-between mb-4"},U={class:"d-flex justify-space-between mb-4"},$={class:"d-flex justify-space-between mb-4"},F={class:"text-h6"},P={key:1,class:"d-flex justify-center align-center",style:{"min-height":"400px"}},O={class:"text-primary"},A={class:"text-h6 text-primary"},N=x(e({__name:"CartView",setup(e){const x=o(),N=a(!1),R=a(!1),T=a([]),E=a([]),Q=a(!1),Y=a(!1),B=a(!1),D=a(null),G=a({show:!1,text:"",color:"success"}),H=l((()=>T.value.reduce(((e,a)=>e+a.attributes.quantity),0))),J=l((()=>T.value.filter((e=>E.value.includes(e.id))).reduce(((e,a)=>e+a.attributes.product.price*a.attributes.quantity),0))),K=async()=>{N.value=!0;try{const e=await y.getCartItems();T.value=e.data,E.value=T.value.map((e=>e.id))}catch(e){}finally{N.value=!1}},L=async(e,a)=>{const l=e.attributes.quantity+a;if(!(l<1||l>e.attributes.product.stock_quantity))try{await y.updateCartItem(e.id,l),e.attributes.quantity=l}catch(t){}},M=()=>{Q.value=!0},W=async()=>{R.value=!0;try{await y.clearCart(),T.value=[],E.value=[],Q.value=!1}catch(e){}finally{R.value=!1}},X=a({recipient_name:"",phone_number:"",shipping_address:"",postal_code:""}),Z=l((()=>T.value.filter((e=>E.value.includes(e.id))))),ee=(e,a="success")=>{G.value={show:!0,text:e,color:a}},ae=()=>{E.value.length&&(Y.value=!0)},le=async()=>{if(D.value.validate()){R.value=!0;try{const e={order:X.value,items:Z.value.map((e=>({product_id:e.attributes.product.id,quantity:e.attributes.quantity})))},a=await g.createOrder(e);await Promise.all(Z.value.map((e=>y.removeFromCart(e.id)))),ee("Order placed successfully!"),Y.value=!1,X.value={recipient_name:"",phone_number:"",shipping_address:"",postal_code:""},await K(),x.push({name:"order-detail",params:{id:a.data.id}})}catch(e){ee("Failed to place order. Please try again.","error")}finally{R.value=!1}}};return t(Y,(e=>{e||(X.value={recipient_name:"",phone_number:"",shipping_address:"",postal_code:""},D.value&&D.value.reset())})),u((()=>{K()})),(e,a)=>{const l=n("v-icon"),t=n("v-chip"),u=n("v-spacer"),o=n("v-btn"),g=n("v-col"),K=n("v-row"),ee=n("v-checkbox"),te=n("v-progress-circular"),ue=n("v-img"),ie=n("v-list-item-title"),se=n("v-list-item-subtitle"),re=n("v-list-item"),de=n("v-list"),oe=n("v-card"),ne=n("v-card-title"),ce=n("v-divider"),me=n("v-card-text"),pe=n("v-card-actions"),ve=n("v-dialog"),fe=n("v-container"),_e=n("v-avatar"),be=n("v-text-field"),he=n("v-textarea"),ye=n("v-form"),ge=n("v-snackbar");return c(),i(d,null,[s(fe,null,{default:r((()=>[s(K,null,{default:r((()=>[s(g,{cols:"12"},{default:r((()=>[m("div",k,[s(l,{icon:"mdi-cart",size:"x-large",class:"me-3"}),a[12]||(a[12]=m("h1",{class:"text-h4 mb-0"},"Shopping Cart",-1)),s(t,{class:"ml-4",color:"primary",size:"large"},{default:r((()=>[p(v(T.value.length)+" "+v(1===T.value.length?"item":"items"),1)])),_:1}),s(u),s(o,{color:"error",variant:"text","prepend-icon":"mdi-delete",disabled:!T.value.length,onClick:M},{default:r((()=>a[11]||(a[11]=[p(" Clear Cart ")]))),_:1},8,["disabled"])])])),_:1})])),_:1}),N.value?(c(),i("div",P,[s(te,{indeterminate:"",size:"64",color:"primary"})])):(c(),f(K,{key:0},{default:r((()=>[T.value.length?(c(),i(d,{key:0},[s(g,{cols:"12",md:"8"},{default:r((()=>[s(oe,null,{default:r((()=>[s(de,null,{default:r((()=>[(c(!0),i(d,null,_(T.value,(e=>(c(),f(re,{key:e.id,value:e.id},{prepend:r((()=>[s(ee,{modelValue:E.value,"onUpdate:modelValue":a[0]||(a[0]=e=>E.value=e),value:e.id,"hide-details":""},null,8,["modelValue","value"])])),append:r((()=>[m("div",q,[m("div",j,[s(o,{icon:"mdi-minus",size:"small",variant:"outlined",disabled:e.attributes.quantity<=1,onClick:a=>L(e,-1)},null,8,["disabled","onClick"]),m("span",S,v(e.attributes.quantity),1),s(o,{icon:"mdi-plus",size:"small",variant:"outlined",disabled:e.attributes.quantity>=e.attributes.product.stock_quantity,onClick:a=>L(e,1)},null,8,["disabled","onClick"])]),m("div",z,"$"+v((e.attributes.product.price*e.attributes.quantity).toFixed(2)),1),s(o,{class:"mt-2",density:"compact",color:"error",variant:"text","prepend-icon":"mdi-delete",onClick:a=>(async e=>{try{await y.removeFromCart(e.id),T.value=T.value.filter((a=>a.id!==e.id)),E.value=E.value.filter((a=>a!==e.id))}catch(a){}})(e)},{default:r((()=>a[13]||(a[13]=[p(" Remove ")]))),_:2},1032,["onClick"])])])),default:r((()=>[m("template",null,[s(ue,{src:e.attributes.product.image_url||"/placeholder.png",width:"100",height:"100",cover:"",class:"ma-2 rounded",onClick:a=>b(x).push(`/products/${e.attributes.product.id}`),style:{cursor:"pointer"}},{placeholder:r((()=>[s(K,{class:"fill-height ma-0",align:"center",justify:"center"},{default:r((()=>[s(te,{indeterminate:"",color:"grey-lighten-5"})])),_:1})])),_:2},1032,["src","onClick"])]),s(ie,{class:"text-subtitle-1 mb-1"},{default:r((()=>[p(v(e.attributes.product.product_name),1)])),_:2},1024),s(se,null,{default:r((()=>[m("div",C,[m("span",V,"$"+v(e.attributes.product.price),1),e.attributes.product.in_stock?h("",!0):(c(),i("span",w," Out of Stock "))])])),_:2},1024)])),_:2},1032,["value"])))),128))])),_:1})])),_:1})])),_:1}),s(g,{cols:"12",md:"4"},{default:r((()=>[s(oe,{class:"sticky-card"},{default:r((()=>[s(ne,{class:"bg-surface-variant"},{default:r((()=>a[14]||(a[14]=[p(" Order Summary ")]))),_:1}),s(me,{class:"pt-4"},{default:r((()=>[m("div",I,[a[15]||(a[15]=m("span",null,"Selected Items:",-1)),m("span",null,v(E.value.length),1)]),m("div",U,[a[16]||(a[16]=m("span",null,"Total Items:",-1)),m("span",null,v(H.value),1)]),m("div",$,[a[17]||(a[17]=m("span",{class:"text-subtitle-1"},"Subtotal:",-1)),m("span",F,"$"+v(J.value.toFixed(2)),1)]),s(ce,{class:"mb-4"}),s(o,{color:"primary",size:"large",block:"","prepend-icon":"mdi-cart-check",disabled:!E.value.length,onClick:ae},{default:r((()=>[p(" Checkout ("+v(E.value.length)+" items) ",1)])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})],64)):(c(),f(g,{key:1,cols:"12"},{default:r((()=>[s(oe,{class:"text-center pa-12"},{default:r((()=>[s(l,{icon:"mdi-cart-outline",size:"100",color:"grey-lighten-1",class:"mb-4"}),a[19]||(a[19]=m("h3",{class:"text-h5 mb-2"},"Your Cart is Empty",-1)),a[20]||(a[20]=m("p",{class:"text-body-1 mb-6"},"Start adding items to your cart!",-1)),s(o,{color:"primary",size:"large",to:"/products","prepend-icon":"mdi-shopping"},{default:r((()=>a[18]||(a[18]=[p(" Continue Shopping ")]))),_:1})])),_:1})])),_:1}))])),_:1})),s(ve,{modelValue:Q.value,"onUpdate:modelValue":a[2]||(a[2]=e=>Q.value=e),"max-width":"400"},{default:r((()=>[s(oe,null,{default:r((()=>[s(ne,null,{default:r((()=>a[21]||(a[21]=[p("Clear Shopping Cart")]))),_:1}),s(me,null,{default:r((()=>a[22]||(a[22]=[p(" Are you sure you want to remove all items from your cart? ")]))),_:1}),s(pe,null,{default:r((()=>[s(u),s(o,{variant:"text",onClick:a[1]||(a[1]=e=>Q.value=!1)},{default:r((()=>a[23]||(a[23]=[p(" Cancel ")]))),_:1}),s(o,{color:"error",variant:"text",loading:R.value,onClick:W},{default:r((()=>a[24]||(a[24]=[p(" Clear Cart ")]))),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1}),s(ve,{modelValue:Y.value,"onUpdate:modelValue":a[9]||(a[9]=e=>Y.value=e),"max-width":"800",persistent:""},{default:r((()=>[s(oe,null,{default:r((()=>[s(ne,{class:"bg-primary text-white"},{default:r((()=>a[25]||(a[25]=[p(" Checkout ")]))),_:1}),s(me,{class:"pt-4"},{default:r((()=>[s(K,null,{default:r((()=>[s(g,{cols:"12",md:"6"},{default:r((()=>[a[27]||(a[27]=m("h3",{class:"text-h6 mb-4"},"Order Items",-1)),s(de,null,{default:r((()=>[(c(!0),i(d,null,_(Z.value,(e=>(c(),f(re,{key:e.id,density:"compact"},{prepend:r((()=>[s(_e,{size:"40"},{default:r((()=>[s(ue,{src:e.attributes.product.image_url||"/placeholder.png",cover:""},null,8,["src"])])),_:2},1024)])),append:r((()=>[m("div",O," $"+v((e.attributes.quantity*e.attributes.product.price).toFixed(2)),1)])),default:r((()=>[s(ie,null,{default:r((()=>[p(v(e.attributes.product.product_name),1)])),_:2},1024),s(se,null,{default:r((()=>[p(" Qty: "+v(e.attributes.quantity)+" Ã— $"+v(e.attributes.product.price),1)])),_:2},1024)])),_:2},1024)))),128)),s(ce,{class:"my-2"}),s(re,null,{append:r((()=>[m("div",A," $"+v(J.value.toFixed(2)),1)])),default:r((()=>[s(ie,{class:"text-h6"},{default:r((()=>a[26]||(a[26]=[p(" Total Amount ")]))),_:1})])),_:1})])),_:1})])),_:1}),s(g,{cols:"12",md:"6"},{default:r((()=>[a[28]||(a[28]=m("h3",{class:"text-h6 mb-4"},"Shipping Information",-1)),s(ye,{ref_key:"form",ref:D,modelValue:B.value,"onUpdate:modelValue":a[7]||(a[7]=e=>B.value=e)},{default:r((()=>[s(be,{modelValue:X.value.recipient_name,"onUpdate:modelValue":a[3]||(a[3]=e=>X.value.recipient_name=e),label:"Recipient Name",rules:[e=>!!e||"Name is required"],variant:"outlined",density:"comfortable",class:"mb-2"},null,8,["modelValue","rules"]),s(be,{modelValue:X.value.phone_number,"onUpdate:modelValue":a[4]||(a[4]=e=>X.value.phone_number=e),label:"Phone Number",rules:[e=>!!e||"Phone number is required",e=>/^\d{10,11}$/.test(e)||"Invalid phone number"],variant:"outlined",density:"comfortable",class:"mb-2"},null,8,["modelValue","rules"]),s(he,{modelValue:X.value.shipping_address,"onUpdate:modelValue":a[5]||(a[5]=e=>X.value.shipping_address=e),label:"Shipping Address",rules:[e=>!!e||"Address is required"],variant:"outlined",density:"comfortable","auto-grow":"",rows:"3",class:"mb-2"},null,8,["modelValue","rules"]),s(be,{modelValue:X.value.postal_code,"onUpdate:modelValue":a[6]||(a[6]=e=>X.value.postal_code=e),label:"Postal Code",rules:[e=>!!e||"Postal code is required",e=>/^\d{5,6}$/.test(e)||"Invalid postal code"],variant:"outlined",density:"comfortable"},null,8,["modelValue","rules"])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),s(pe,null,{default:r((()=>[s(u),s(o,{variant:"text",onClick:a[8]||(a[8]=e=>Y.value=!1),disabled:R.value},{default:r((()=>a[29]||(a[29]=[p(" Cancel ")]))),_:1},8,["disabled"]),s(o,{color:"primary",loading:R.value,disabled:!B.value,onClick:le},{default:r((()=>a[30]||(a[30]=[p(" Place Order ")]))),_:1},8,["loading","disabled"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),s(ge,{modelValue:G.value.show,"onUpdate:modelValue":a[10]||(a[10]=e=>G.value.show=e),color:G.value.color,timeout:3e3},{default:r((()=>[p(v(G.value.text),1)])),_:1},8,["modelValue","color"])],64)}}}),[["__scopeId","data-v-8118c9a1"]]);export{N as default};
